{"version":3,"sources":["locale-switch.ts"],"names":[],"mappings":"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","file":"locale-switch.js","sourcesContent":["\nimport '@main';\n\ninterface LocaleSwitchOptions {\n  type: string;\n  table: string;\n  routeName: string;\n  currentId: string;\n  defaultId: string;\n  inputId: string;\n  langField: string;\n  titleField: string;\n  triggerInputName: string;\n}\n\nexport class LocaleSwitchModal {\n  public options: LocaleSwitchOptions = {\n    type: '',\n    table: '',\n    routeName: '',\n    currentId: '',\n    defaultId: '',\n    inputId: '',\n    langField: '',\n    titleField: '',\n    triggerInputName: 'lang_assoc'\n  };\n\n  constructor(public el: HTMLElement, options: Partial<LocaleSwitchOptions> = {}) {\n    // the modal element\n    this.options = Object.assign({}, this.options, options);\n\n    let buttons = this.el.querySelectorAll<HTMLButtonElement|HTMLAnchorElement>('[data-task=create_lang_version]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.saveCurrentAndCreateLang(button);\n      });\n    });\n\n    buttons = this.el.querySelectorAll<HTMLButtonElement|HTMLAnchorElement>('[data-task=switch_lang]');\n\n    u.each(buttons, (button) => {\n      button.addEventListener('click', (e) => {\n        this.switchLang(button);\n      });\n    });\n  }\n\n  validateForm() {\n    const input = document.querySelector<HTMLInputElement>('#' + this.options.inputId)!;\n\n    const form = input.form;\n\n    if (!form) {\n      return undefined;\n    }\n\n    const validation = u.$validation.get(form)!;\n\n    const valid = validation.validateAll();\n\n    if (!valid) {\n      alert(u.__('luna.field.locale.switch.message.form.invalid'));\n      throw new Error('Form invalid');\n    }\n\n    return form;\n  }\n\n  /**\n   * @param {HTMLButtonElement} button\n   */\n  saveCurrentAndCreateLang(button: HTMLAnchorElement | HTMLButtonElement) {\n    const form = this.validateForm()!;\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'create',\n          type: this.options.type,\n          table: this.options.table,\n          routeName: this.options.routeName,\n          code: button.dataset.lang,\n          copy: button.dataset.copy,\n          langField: this.options.langField,\n          titleField: this.options.titleField,\n          currentId: this.options.currentId,\n          defaultId: this.options.defaultId\n        }\n      }\n    );\n  }\n\n  switchLang(button: HTMLAnchorElement | HTMLButtonElement) {\n    const form = this.validateForm()!;\n\n    u.form(form).post(\n      null,\n      {\n        [this.options.triggerInputName]: {\n          task: 'switch',\n          table: this.options.table,\n          routeName: this.options.routeName,\n          targetId: button.dataset.targetId\n        }\n      }\n    );\n  }\n}\n\nu.directive(\n  'locale-switch-modal',\n  {\n    mounted(el, { value }) {\n      const options = JSON.parse(value);\n\n      u.module(el, 'locale.switch', () => new LocaleSwitchModal(el as HTMLElement, options));\n    }\n  }\n);\n\n"]}