{"version":3,"file":"luna.js","sources":["../src/composables/useAccountCheck.ts","../src/composables/useCaptcha.ts","../src/composables/useLangDropdown.ts","../src/composables/useLocaleSwitch.ts","../src/composables/useSrp.ts","../src/composables/usePageBuilder.ts","../src/luna.ts"],"sourcesContent":["import { __, addGlobalValidator, ApiReturn, route, useHttpClient } from '@windwalker-io/unicorn-next';\r\n\r\nexport async function useAccountCheck() {\r\n  const { get } = await useHttpClient();\r\n\r\n  await addGlobalValidator('account_check', async (account: any, input: any, options: any) => {\r\n    const field = options.field || 'username';\r\n\r\n    const res = await get<ApiReturn<{ exists: boolean; message: string; }>>(\r\n      '@account_check',\r\n      { params: { field: field, value: account } }\r\n    );\r\n\r\n    if (res.data.data.exists) {\r\n      return res.data.data.message || __('luna.message.user.account.exists');\r\n    }\r\n\r\n    return '';\r\n  });\r\n}\r\n\r\n","export function useCaptcha() {\r\n  return import('../modules/captcha');\r\n}\r\n","import { prepareAlpine, useHttpClient } from '@windwalker-io/unicorn-next';\r\nimport { Dropdown } from 'bootstrap';\r\n\r\nexport async function useLangDropdown() {\r\n  await prepareAlpine(async (Alpine) => {\r\n    Alpine.data('LangDropdown', (options: any) => ({\r\n      options,\r\n      dropdown: null,\r\n      items: [],\r\n      loaded: false,\r\n\r\n      init() {\r\n        this.dropdown = Dropdown.getOrCreateInstance(\r\n          // @ts-ignore\r\n          this.$el,\r\n          {\r\n            autoClose: true\r\n          }\r\n        ) as any;\r\n      },\r\n      async buttonClicked(e: Event): Promise<any> {\r\n        if (this.loaded) {\r\n          return;\r\n        }\r\n\r\n        const options = this.options as any;\r\n\r\n        const { get } = await useHttpClient();\r\n\r\n        let res = await get(\r\n          options.ajaxUrl,\r\n          {\r\n            params: {\r\n              id: options.id,\r\n              type: options.type,\r\n              table: options.table,\r\n              idName: options.idName,\r\n              langField: options.langField,\r\n              routeName: options.routeName,\r\n            }\r\n          }\r\n        );\r\n\r\n        this.items = res.data.data;\r\n\r\n        this.loaded = true;\r\n      }\r\n    }));\r\n  });\r\n\r\n  // selectAll('[data-langdropdown]', (el) => {\r\n  //   el.removeAttribute('x-ignore');\r\n  // });\r\n  //\r\n  // initAlpineComponent('data-langdropdown');\r\n\r\n  // document.addEventListener('alpine:init', async () => {\r\n  //\r\n  // });\r\n}\r\n\r\n","export function useLocaleSwitch() {\r\n  return import('../modules/locale-switch');\r\n}\r\n","export function useSrp() {\r\n  return import('../modules/srp');\r\n}\r\n","export async function usePageBuilder(rootContainer: string | Element = 'page-builder-app') {\r\n  import('../modules/page-builder');\r\n}\r\n","import { UnicornApp, useMacro, useUnicorn } from '@windwalker-io/unicorn-next';\r\nimport { useAccountCheck, useCaptcha, useLangDropdown, useLocaleSwitch } from '~luna/composables';\r\n\r\nexport * from './composables/useAccountCheck';\r\nexport * from './composables/useCaptcha';\r\nexport * from './composables/useLangDropdown';\r\nexport * from './composables/useLocaleSwitch';\r\nexport * from './composables/useSrp';\r\nexport * from './composables/usePageBuilder';\r\n\r\nexport function createLuna() {\r\n  return {\r\n    install(app: UnicornApp) {\r\n      const $luna = {\r\n        useAccountCheck,\r\n        useCaptcha,\r\n        useLangDropdown,\r\n        useLocaleSwitch,\r\n      };\r\n\r\n      useMacro('$luna', $luna);\r\n    }\r\n  }\r\n}\r\n\r\nexport function useLuna() {\r\n  const u = useUnicorn();\r\n\r\n  u.use(createLuna());\r\n}\r\n\r\ndeclare module '@windwalker-io/unicorn-next' {\r\n  interface UnicornApp {\r\n    $luna: {\r\n      useAccountCheck: typeof useAccountCheck;\r\n      useCaptcha: typeof useCaptcha;\r\n      useLangDropdown: typeof useLangDropdown;\r\n      useLocaleSwitch: typeof useLocaleSwitch;\r\n    }\r\n  }\r\n}\r\n"],"names":["options"],"mappings":";;;AAEA,eAAsB,kBAAkB;AACtC,QAAM,EAAE,QAAQ,MAAM,cAAA;AAEtB,QAAM,mBAAmB,iBAAiB,OAAO,SAAc,OAAY,YAAiB;AAC1F,UAAM,QAAQ,QAAQ,SAAS;AAE/B,UAAM,MAAM,MAAM;AAAA,MAChB;AAAA,MACA,EAAE,QAAQ,EAAE,OAAc,OAAO,UAAQ;AAAA,IAAE;AAG7C,QAAI,IAAI,KAAK,KAAK,QAAQ;AACxB,aAAO,IAAI,KAAK,KAAK,WAAW,GAAG,kCAAkC;AAAA,IACvE;AAEA,WAAO;AAAA,EACT,CAAC;AACH;ACnBO,SAAS,aAAa;AAC3B,SAAO,OAAO,qBAAoB;AACpC;ACCA,eAAsB,kBAAkB;AACtC,QAAM,cAAc,OAAO,WAAW;AACpC,WAAO,KAAK,gBAAgB,CAAC,aAAkB;AAAA,MAC7C;AAAA,MACA,UAAU;AAAA,MACV,OAAO,CAAA;AAAA,MACP,QAAQ;AAAA,MAER,OAAO;AACL,aAAK,WAAW,SAAS;AAAA;AAAA,UAEvB,KAAK;AAAA,UACL;AAAA,YACE,WAAW;AAAA,UAAA;AAAA,QACb;AAAA,MAEJ;AAAA,MACA,MAAM,cAAc,GAAwB;AAC1C,YAAI,KAAK,QAAQ;AACf;AAAA,QACF;AAEA,cAAMA,WAAU,KAAK;AAErB,cAAM,EAAE,QAAQ,MAAM,cAAA;AAEtB,YAAI,MAAM,MAAM;AAAA,UACdA,SAAQ;AAAA,UACR;AAAA,YACE,QAAQ;AAAA,cACN,IAAIA,SAAQ;AAAA,cACZ,MAAMA,SAAQ;AAAA,cACd,OAAOA,SAAQ;AAAA,cACf,QAAQA,SAAQ;AAAA,cAChB,WAAWA,SAAQ;AAAA,cACnB,WAAWA,SAAQ;AAAA,YAAA;AAAA,UACrB;AAAA,QACF;AAGF,aAAK,QAAQ,IAAI,KAAK;AAEtB,aAAK,SAAS;AAAA,MAChB;AAAA,IAAA,EACA;AAAA,EACJ,CAAC;AAWH;AC3DO,SAAS,kBAAkB;AAChC,SAAO,OAAO,2BAA0B;AAC1C;ACFO,SAAS,SAAS;AACvB,SAAO,OAAO,iBAAgB;AAChC;ACFA,eAAsB,eAAe,gBAAkC,oBAAoB;AACzF,SAAO,0BAAyB,EAAA,KAAA,OAAA,EAAA,CAAA;AAClC;ACQO,SAAS,aAAa;AAC3B,SAAO;AAAA,IACL,QAAQ,KAAiB;AACvB,YAAM,QAAQ;AAAA,QACZ;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAGF,eAAS,SAAS,KAAK;AAAA,IACzB;AAAA,EAAA;AAEJ;AAEO,SAAS,UAAU;AACxB,QAAM,IAAI,WAAA;AAEV,IAAE,IAAI,YAAY;AACpB;"}