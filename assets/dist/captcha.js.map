{"version":3,"sources":["captcha.js"],"names":["System","register","_export","_context","GragwarCaptcha","RecaptchaCaptcha","setters","execute","constructor","el","options","this","$element","$image","querySelector","$input","addEventListener","refresh","$buttonIcon","classList","src","$refreshButton","t","Date","getTime","toString","Math","random","indexOf","remove","value","clear","u","directive","mounted","type","module","key","dataset","jsVerify","import","form","closest","e","callbackName","passCaptcha","stopImmediatePropagation","grecaptcha","window","response","preventDefault","stopPropagation","alert","__","_ref"],"mappings":"AAAAA,OAAOC,SAAS,IAAI,SAAUC,EAASC,GAGrC,IAIIC,EA6CAC,EAAgB,MAAA,CAAAC,QAAA,GAAAC,QAAA,WApDtBH,EAAA,MACAI,YAAAC,EAAAC,GACAC,KAAAC,SAAAH,EACAE,KAAAD,QAAAA,EACAC,KAAAE,OAAAF,KAAAC,SAAAE,cAAA,wBACAH,KAAAI,OAAAJ,KAAAC,SAAAE,cAAA,wBAEMV,KAAAA,eAAAA,KAAAA,SAAeU,cAAA,0BACnBN,KAAAA,YAAgBE,KAASE,SAAAE,cAAA,uBACvBH,KAAKC,eAAaI,iBAAA,SAAA,KAClBL,KAAKD,SAAUA,GAQX,CACAO,UALJN,KAAKO,YAAWC,UAAQP,IAAAA,WAExB,IAAIQ,EAACC,KAAAA,OAAeL,QAAAA,MAMd,MALAM,GAACL,IAAOM,MAAEC,UAAAC,WAAA,IAAA,IAAAC,KAAAC,UACd,IAAAP,EAAAQ,QAAA,KACJR,GAAA,MAAAE,EAGEF,GAAKF,MAAYC,EAGjBR,KAAAE,OAAWG,iBAAkB,QAAES,KAE/Bd,KAAOO,YAAYC,UAAUU,OAAA,WAC3BT,KAAGL,OAASe,MAAI,EAAA,GACjB,CACCV,MAAG,IAGLT,KAAKE,OAAOG,IAAAA,CAER,CACAe,QAAJpB,KAAGI,OAAAe,MAAA,EAEC,GAEFE,EAAEC,UAFCpB,kBAAgB,CACvBqB,QAAAzB,GAEAsB,EAAAA,OAAQtB,EAAA,mBAAAA,GAAA,IAAAL,EAAAK,IAEF,IACRJ,EAAC,MAEC4B,YAAUxB,EAAA0B,GAQRH,GAPFE,EAAAA,OAAU,oEACRF,KAAEI,GAAO3B,EACXE,KAAAwB,KAAAA,EACAxB,KAAA0B,IAAA1B,KAAAF,GAAA6B,QAAAD,IAEIhC,KAAAA,aAANM,KAAMN,GAAAA,QAAAA,SACJG,KAAAA,SAAgB2B,KAAM1B,GAAA6B,QAAAC,SAClBC,KAAOD,SAAA,CAET,MAAOE,EAAK9B,KAAAF,GAAAiC,QAAA,QACAP,cAAPA,GAEDM,EAAIzB,iBAAkB,UAAI2B,IACzBC,EAAAA,QAAeC,cAKlBF,EAAMF,iBAEFN,EAAAA,kBACFM,EAAIK,2BACFC,WAAST,UAAQO,IAJbG,OAMJrC,KAAAiC,cAAA,SAAAK,GAEAN,EAAEO,QAAAA,YAAgB,OAClBP,EAAEQ,eANE,IAUNV,EAAEzB,iBAAA,UAAA2B,IAEIF,EAAKH,QAACM,cAGXD,EAAAO,iBACFP,EAAAQ,kBACCV,EAAIK,2BACFM,MAAIX,EAAIY,GAACf,kDAAqB,IAP1BU,OASJrC,KAAAiC,cAAA,SAAAK,GAEAN,EAAEO,QAAAA,YAAgB,MATd,EAEJ,CACF,GAEFlB,EAAEC,UAYEQ,oBAAaI,CAXfX,QAYCzB,EAAA6C,GAXC,IAYJxB,MACFA,GACFwB,EACDtB,EAAAI,OAAA3B,EAAA,qBAAAA,GAAA,IAAAJ,EAAAI,EAAAqB,IAECG,GAXE,EAEJ","file":"captcha.js","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2022 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nclass GragwarCaptcha {\n  constructor(el, options) {\n    this.$element = el;\n    this.options = options;\n    this.$image = this.$element.querySelector('[data-captcha-image]');\n    this.$input = this.$element.querySelector('[data-captcha-input]');\n    this.$refreshButton = this.$element.querySelector('[data-captcha-refresh]');\n    this.$buttonIcon = this.$element.querySelector('[data-refresh-icon]');\n\n    this.$refreshButton.addEventListener('click', () => {\n      this.refresh();\n    });\n  }\n\n  refresh() {\n    this.$buttonIcon.classList.add('fa-spin');\n\n    let src = this.$image.dataset.image;\n    const t = (new Date).getTime().toString() + '.' + (Math.random() * 10000);\n\n    if (src.indexOf('?') !== -1) {\n      src += '&t=' + t;\n    } else {\n      src += '?t=' + t;\n    }\n\n    this.$image.addEventListener('load', () => {\n      this.$buttonIcon.classList.remove('fa-spin');\n      this.$input.value= '';\n    }, { once: true });\n\n    this.$image.src = src;\n  }\n\n  clear() {\n    this.$input.value = '';\n  }\n}\n\nu.directive('captcha-gregwar', {\n  mounted(el) {\n    u.module(el, 'captcha.grwgwar', (el) => new GragwarCaptcha(el));\n  }\n});\n\nclass RecaptchaCaptcha {\n  constructor(el, type) {\n    u.import('https://www.google.com/recaptcha/api.js?96a5011cd07503030e4865a1');\n\n    this.el = el;\n    this.type = type;\n\n    this.key = this.el.dataset.key;\n    this.callbackName = this.el.dataset.callback;\n\n    this.jsVerify = this.el.dataset.jsVerify;\n\n    if (this.jsVerify) {\n      const form = this.el.closest('form');\n\n      if (type === 'invisible') {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          grecaptcha.execute();\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n          form.requestSubmit();\n        }\n      } else {\n        form.addEventListener('submit', (e) => {\n          if (form.dataset.passCaptcha) {\n            return;\n          }\n\n          e.preventDefault();\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n\n          alert(u.__('luna.field.captcha.message.please.check.first'));\n        });\n\n        window[this.callbackName] = function(response) {\n          form.dataset.passCaptcha = 'true';\n        }\n      }\n    }\n  }\n}\n\nu.directive('captcha-recaptcha', {\n  mounted(el, { value }) {\n    u.module(el, 'captcha.recaptcha', (el) => new RecaptchaCaptcha(el, value));\n  }\n});\n"]}