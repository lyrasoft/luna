{"version":3,"file":"locale-switch.js","sources":["../../src/modules/locale-switch.ts"],"sourcesContent":["import { __, module, useForm, useFormValidationInstance, useUniDirective } from '@windwalker-io/unicorn-next';\r\n\r\ninterface LocaleSwitchOptions {\r\n  type: string;\r\n  table: string;\r\n  routeName: string;\r\n  currentId: string;\r\n  defaultId: string;\r\n  inputId: string;\r\n  langField: string;\r\n  titleField: string;\r\n  triggerInputName: string;\r\n}\r\n\r\nexport class LocaleSwitchModal {\r\n  public options: LocaleSwitchOptions = {\r\n    type: '',\r\n    table: '',\r\n    routeName: '',\r\n    currentId: '',\r\n    defaultId: '',\r\n    inputId: '',\r\n    langField: '',\r\n    titleField: '',\r\n    triggerInputName: 'lang_assoc'\r\n  };\r\n\r\n  constructor(public el: HTMLElement, options: Partial<LocaleSwitchOptions> = {}) {\r\n    // the modal element\r\n    this.options = Object.assign({}, this.options, options);\r\n\r\n    let buttons = this.el.querySelectorAll<HTMLButtonElement|HTMLAnchorElement>('[data-task=create_lang_version]');\r\n\r\n    for (const button of buttons) {\r\n      button.addEventListener('click', (e) => {\r\n        this.saveCurrentAndCreateLang(button);\r\n      });\r\n    }\r\n\r\n    buttons = this.el.querySelectorAll<HTMLButtonElement|HTMLAnchorElement>('[data-task=switch_lang]');\r\n\r\n    for (const button of buttons) {\r\n      button.addEventListener('click', (e) => {\r\n        this.switchLang(button);\r\n      });\r\n    }\r\n  }\r\n\r\n  validateForm() {\r\n    const input = document.querySelector<HTMLInputElement>('#' + this.options.inputId)!;\r\n\r\n    const form = input.form;\r\n\r\n    if (!form) {\r\n      return undefined;\r\n    }\r\n\r\n    const validation = useFormValidationInstance(form)!;\r\n\r\n    const valid = validation.validateAll();\r\n\r\n    if (!valid) {\r\n      alert(__('luna.field.locale.switch.message.form.invalid'));\r\n      throw new Error('Form invalid');\r\n    }\r\n\r\n    return form;\r\n  }\r\n\r\n  /**\r\n   * @param {HTMLButtonElement} button\r\n   */\r\n  saveCurrentAndCreateLang(button: HTMLAnchorElement | HTMLButtonElement) {\r\n    const form = this.validateForm()!;\r\n\r\n    useForm(form)?.post(\r\n      null,\r\n      {\r\n        [this.options.triggerInputName]: {\r\n          task: 'create',\r\n          type: this.options.type,\r\n          table: this.options.table,\r\n          routeName: this.options.routeName,\r\n          code: button.dataset.lang,\r\n          copy: button.dataset.copy,\r\n          langField: this.options.langField,\r\n          titleField: this.options.titleField,\r\n          currentId: this.options.currentId,\r\n          defaultId: this.options.defaultId\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  switchLang(button: HTMLAnchorElement | HTMLButtonElement) {\r\n    const form = this.validateForm()!;\r\n\r\n    useForm(form)?.post(\r\n      null,\r\n      {\r\n        [this.options.triggerInputName]: {\r\n          task: 'switch',\r\n          table: this.options.table,\r\n          routeName: this.options.routeName,\r\n          targetId: button.dataset.targetId\r\n        }\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nuseUniDirective(\r\n  'locale-switch-modal',\r\n  {\r\n    mounted(el, { value }) {\r\n      const options = JSON.parse(value);\r\n\r\n      module(el, 'locale.switch', () => new LocaleSwitchModal(el as HTMLElement, options));\r\n    }\r\n  }\r\n);\r\n\r\n"],"names":["module"],"mappings":";AAcO,MAAM,kBAAkB;AAAA,EAa7B,YAAmB,IAAiB,UAAwC,IAAI;AAA7D,SAAA,KAAA;AAEjB,SAAK,UAAU,OAAO,OAAO,CAAA,GAAI,KAAK,SAAS,OAAO;AAEtD,QAAI,UAAU,KAAK,GAAG,iBAAsD,iCAAiC;AAE7G,eAAW,UAAU,SAAS;AAC5B,aAAO,iBAAiB,SAAS,CAAC,MAAM;AACtC,aAAK,yBAAyB,MAAM;AAAA,MACtC,CAAC;AAAA,IACH;AAEA,cAAU,KAAK,GAAG,iBAAsD,yBAAyB;AAEjG,eAAW,UAAU,SAAS;AAC5B,aAAO,iBAAiB,SAAS,CAAC,MAAM;AACtC,aAAK,WAAW,MAAM;AAAA,MACxB,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EA/BO,UAA+B;AAAA,IACpC,MAAM;AAAA,IACN,OAAO;AAAA,IACP,WAAW;AAAA,IACX,WAAW;AAAA,IACX,WAAW;AAAA,IACX,SAAS;AAAA,IACT,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,kBAAkB;AAAA,EAAA;AAAA,EAwBpB,eAAe;AACb,UAAM,QAAQ,SAAS,cAAgC,MAAM,KAAK,QAAQ,OAAO;AAEjF,UAAM,OAAO,MAAM;AAEnB,QAAI,CAAC,MAAM;AACT,aAAO;AAAA,IACT;AAEA,UAAM,aAAa,0BAA0B,IAAI;AAEjD,UAAM,QAAQ,WAAW,YAAA;AAEzB,QAAI,CAAC,OAAO;AACV,YAAM,GAAG,+CAA+C,CAAC;AACzD,YAAM,IAAI,MAAM,cAAc;AAAA,IAChC;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAyB,QAA+C;AACtE,UAAM,OAAO,KAAK,aAAA;AAElB,YAAQ,IAAI,GAAG;AAAA,MACb;AAAA,MACA;AAAA,QACE,CAAC,KAAK,QAAQ,gBAAgB,GAAG;AAAA,UAC/B,MAAM;AAAA,UACN,MAAM,KAAK,QAAQ;AAAA,UACnB,OAAO,KAAK,QAAQ;AAAA,UACpB,WAAW,KAAK,QAAQ;AAAA,UACxB,MAAM,OAAO,QAAQ;AAAA,UACrB,MAAM,OAAO,QAAQ;AAAA,UACrB,WAAW,KAAK,QAAQ;AAAA,UACxB,YAAY,KAAK,QAAQ;AAAA,UACzB,WAAW,KAAK,QAAQ;AAAA,UACxB,WAAW,KAAK,QAAQ;AAAA,QAAA;AAAA,MAC1B;AAAA,IACF;AAAA,EAEJ;AAAA,EAEA,WAAW,QAA+C;AACxD,UAAM,OAAO,KAAK,aAAA;AAElB,YAAQ,IAAI,GAAG;AAAA,MACb;AAAA,MACA;AAAA,QACE,CAAC,KAAK,QAAQ,gBAAgB,GAAG;AAAA,UAC/B,MAAM;AAAA,UACN,OAAO,KAAK,QAAQ;AAAA,UACpB,WAAW,KAAK,QAAQ;AAAA,UACxB,UAAU,OAAO,QAAQ;AAAA,QAAA;AAAA,MAC3B;AAAA,IACF;AAAA,EAEJ;AACF;AAEA;AAAA,EACE;AAAA,EACA;AAAA,IACE,QAAQ,IAAI,EAAE,SAAS;AACrB,YAAM,UAAU,KAAK,MAAM,KAAK;AAEhCA,eAAO,IAAI,iBAAiB,MAAM,IAAI,kBAAkB,IAAmB,OAAO,CAAC;AAAA,IACrF;AAAA,EAAA;AAEJ;"}